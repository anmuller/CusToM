function [Human_model]= Thigh_TLEM(Human_model,k,Signe,Mass,AttachmentPoint)
% Addition of a thigh model
%   This thigh model contains one solid (thigh), exhibits 3 dof for the hip
%   Based on:
%	V. Carbone et al., “TLEM 2.0 - A comprehensive musculoskeletal geometry dataset for subject-specific modeling of lower extremity,” J. Biomech., vol. 48, no. 5, pp. 734–741, 2015.
%   INPUT
%   - Human_model: osteo-articular model of an already existing
%   model (see the Documentation for the structure)
%   - k: homothety coefficient for the geometrical parameters (defined as
%   the subject size in cm divided by 180)
%   - Signe: side of the thigh model ('R' for right side or 'L' for left side)
%   - Mass: mass of the solids
%   - AttachmentPoint: name of the attachment point of the model on the
%   already existing model (character string)
%   OUTPUT
%   - Human_model: new osteo-articular model (see the Documentation
%   for the structure) 
%________________________________________________________
%
% Licence
% Toolbox distributed under GPL 3.0 Licence
%________________________________________________________
%
% Authors : Antoine Muller, Charles Pontonnier, Pierre Puchaud and
% Georges Dumont
%________________________________________________________

%% Variables de sortie :
% "enrichissement de la structure "Human_model""

%% Liste des solides
list_solid={'Hip_J1' 'Hip_J2' 'Thigh'};

%% Choix jambe droite ou gauche
if Signe == 'R'
    Mirror=[1 0 0; 0 1 0; 0 0 1];
else
    if Signe == 'L'
        Mirror=[1 0 0; 0 1 0; 0 0 -1];
    end
end

%% Incrémentation de la numérotation des solides

s=size(Human_model,2)+1;  %#ok<NASGU> % numéro du premier solide
for i=1:size(list_solid,2)      % numérotation de chaque solide : s_"nom du solide"
    if i==1
        eval(strcat('s_',list_solid{i},'=s;'))
    else
        eval(strcat('s_',list_solid{i},'=s_',list_solid{i-1},'+1;'))
    end
end

% trouver le numéro de la mère à partir du nom du point d'attache : 'attachment_pt'
if numel(Human_model) == 0
    s_mother=0;
    pos_attachment_pt=[0 0 0]';
else
    test=0;
    for i=1:numel(Human_model)
        for j=1:size(Human_model(i).anat_position,1)
            if strcmp(AttachmentPoint,Human_model(i).anat_position{j,1})
                s_mother=i;
                pos_attachment_pt=Human_model(i).anat_position{j,2}+Human_model(s_mother).c;
                test=1;
                break
            end
        end
        if i==numel(Human_model) && test==0
            error([AttachmentPoint ' is no existent'])
        end
    end
    if Human_model(s_mother).child == 0      % si la mère n'a pas d'enfant
        Human_model(s_mother).child = eval(['s_' list_solid{1}]);    % l'enfant de cette mère est ce solide
    else
        [Human_model]=sister_actualize(Human_model,Human_model(s_mother).child,eval(['s_' list_solid{1}]));   % recherche de la dernière soeur
    end
end

%%                      Définition des noeuds (articulaires)
%
% TLEM 2.0 – A COMPREHENSIVE MUSCULOSKELETAL GEOMETRY DATASET FOR SUBJECT-SPECIFIC MODELING OF LOWER EXTREMITY
%
%  V. Carbonea*, R. Fluita*, P. Pellikaana, M.M. van der Krogta,b, D. Janssenc, M. Damsgaardd, L. Vignerone, T. Feilkasf, H.F.J.M. Koopmana, N. Verdonschota,c
%
%  aLaboratory of Biomechanical Engineering, MIRA Institute, University of Twente, Enschede, The Netherlands
%  bDepartment of Rehabilitation Medicine, Research Institute MOVE, VU University Medical Center, Amsterdam, The Netherlands
%  cOrthopaedic Research Laboratory, Radboud University Medical Centre, Nijmegen, The Netherlands
%  dAnyBody Technology A/S, Aalborg, Denmark
%  eMaterialise N.V., Leuven, Belgium
%  fBrainlab AG, Munich, Germany
% *The authors Carbone and Fluit contributed equally.
% Journal of Biomechanics, Available online 8 January 2015, http://dx.doi.org/10.1016/j.jbiomech.2014.12.034
%% Adjustement of k
k=k*1.2063; %to fit 50th percentile person of 1.80m height 
% ---------------------------- Thigh --------------------------------------

%Centre de masse
CoM_Thigh=(k*Mirror*[-0.0088	;0.2217;	0.0208]); % dans le repère femur

% Position des noeuds (-CoM pour placer dans un repère centré en son centre
% de masse)

MedialEpicondyle    = k*Mirror*[0 ; 0.00431040; -0.0408280]         -CoM_Thigh; % Condyle femoral medial
LateralEpicondyle   = k*Mirror*[0 ; -0.00431040 ; 0.0408280]        -CoM_Thigh; % Condyle femoral lateral
KNE                 = k*Mirror*[0 ; -0.00431040 ; 0.06]             -CoM_Thigh; % Condyle femoral lateral
LesserTrochanter    = k*Mirror*[-0.0199070 ; 0.30260 ; 0.0139990]   -CoM_Thigh;
GreaterTrochanter   = k*Mirror*[0.00316290 ; 0.329220 ; 0.0695830]  -CoM_Thigh;

Thigh_HipJointNode = (k*Mirror*[0 ; 0.3591 ;	0])             -CoM_Thigh;
Thigh_KneeJointNode = (k*Mirror*[-0.0022	;0.0067;	0])     -CoM_Thigh;
Thigh_PatellaFemurJointNode = (k*Mirror*[0.0055;	0.0057;	0]) -CoM_Thigh;

%% Définition des positions anatomiques

Thigh_position_set = {...
    [Signe 'KNE']                                       , KNE; ...
    [Signe 'LateralEpicondyle']                         , LateralEpicondyle;...
    [Signe 'MedialEpicondyle']                          , MedialEpicondyle; ...
    [Signe 'LesserTrochanter']                          , LesserTrochanter; ...
    [Signe 'GreaterTrochanter']                         , GreaterTrochanter; ...
    [Signe 'Thigh_KneeJointNode']                       , Thigh_KneeJointNode; ...
    [Signe 'Thigh_HipJointNode']                        , Thigh_HipJointNode; ...
    [Signe 'Thigh_PatellaFemurJointNode']               , Thigh_PatellaFemurJointNode; ...
    ['AdductorBrevisDistal1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00172;0.22554;0.02503])     -CoM_Thigh);...
    ['AdductorBrevisDistal2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00071;0.21485;0.02402])     -CoM_Thigh);...
    ['AdductorBrevisMid1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00364;0.24702;0.02712])        -CoM_Thigh);...
    ['AdductorBrevisMid2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00246;0.23627;0.02623])        -CoM_Thigh);...
    ['AdductorBrevisProximal1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00679;0.26827;0.02838])   -CoM_Thigh);...
    ['AdductorBrevisProximal2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0051;0.25768;0.02783])    -CoM_Thigh);...
    ['AdductorLongus1Insertion1' Signe 'Thigh'],(k*Mirror*([0.00986;0.22586;0.01398])            -CoM_Thigh);...
    ['AdductorLongus2Insertion1' Signe 'Thigh'],(k*Mirror*([0.01069;0.20896;0.01208])            -CoM_Thigh);...
    ['AdductorLongus3Insertion1' Signe 'Thigh'],(k*Mirror*([0.01148;0.19249;0.0103])             -CoM_Thigh);...
    ['AdductorLongus4Insertion1' Signe 'Thigh'],(k*Mirror*([0.01219;0.17648;0.00845])            -CoM_Thigh);...
    ['AdductorLongus5Insertion1' Signe 'Thigh'],(k*Mirror*([0.01288;0.1609;0.00672])             -CoM_Thigh);...
    ['AdductorLongus6Insertion1' Signe 'Thigh'],(k*Mirror*([0.01351;0.14576;0.00506])            -CoM_Thigh);...
    ['AdductorMagnusDistal1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01093;0.01454;-0.02939])    -CoM_Thigh);...
    ['AdductorMagnusDistal2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01093;0.01454;-0.02939])    -CoM_Thigh);...
    ['AdductorMagnusDistal3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01093;0.01454;-0.02939])    -CoM_Thigh);...
    ['AdductorMagnusMid1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00577;0.24412;0.03348])        -CoM_Thigh);...
    ['AdductorMagnusMid2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00293;0.22074;0.02864])        -CoM_Thigh);...
    ['AdductorMagnusMid3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0012;0.19532;0.02397])         -CoM_Thigh);...
    ['AdductorMagnusMid4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0006;0.16799;0.0198])          -CoM_Thigh);...
    ['AdductorMagnusMid5Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0004;0.13867;0.01578])         -CoM_Thigh);...
    ['AdductorMagnusMid6Insertion1' Signe 'Thigh'],(k*Mirror*([0.00135;0.10782;0.01234])         -CoM_Thigh);...
    ['AdductorMagnusProximal1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01439;0.29772;0.04405])   -CoM_Thigh);...
    ['AdductorMagnusProximal2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01179;0.28741;0.04097])   -CoM_Thigh);...
    ['AdductorMagnusProximal3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01019;0.2771;0.03801])    -CoM_Thigh);...
    ['AdductorMagnusProximal4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00811;0.26684;0.03512])   -CoM_Thigh);...
    ['BicepsFemorisCaputBreve1Origin1' Signe 'Thigh'],(k*Mirror*([-0.00172;0.21961;0.02546])     -CoM_Thigh);...
    ['BicepsFemorisCaputBreve2Origin1' Signe 'Thigh'],(k*Mirror*([-0.00067;0.16753;0.01767])     -CoM_Thigh);...
    ['BicepsFemorisCaputBreve3Origin1' Signe 'Thigh'],(k*Mirror*([0.00122;0.10762;0.01337])      -CoM_Thigh);...
    ['GastrocnemiusLateralis1Origin1' Signe 'Thigh'],(k*Mirror*([-0.00866;0.00994;0.03635])      -CoM_Thigh);...
    ['GastrocnemiusMedialis1Origin1' Signe 'Thigh'],(k*Mirror*([-0.00851;0.0158;-0.02853])       -CoM_Thigh);...
    ['GastrocnemiusMedialis1Via2' Signe 'Thigh'],(k*Mirror*([-0.01276;0.01103;-0.0167])          -CoM_Thigh);...
    ['GemellusInferior1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00752;0.34984;0.03214])         -CoM_Thigh);...
    ['GemellusSuperior1Insertion1' Signe 'Thigh'],(k*Mirror*([0.00321;0.35505;0.03253])          -CoM_Thigh);...
    ['GluteusMaximusInferior1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00843;0.25911;0.0379])    -CoM_Thigh);...
    ['GluteusMaximusInferior2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00843;0.25911;0.0379])    -CoM_Thigh);...
    ['GluteusMaximusInferior3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00403;0.23844;0.0359])    -CoM_Thigh);...
    ['GluteusMaximusInferior4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00403;0.23844;0.0359])    -CoM_Thigh);...
    ['GluteusMaximusInferior5Insertion1' Signe 'Thigh'],(k*Mirror*([0.00015;0.21838;0.03321])    -CoM_Thigh);...
    ['GluteusMaximusInferior6Insertion1' Signe 'Thigh'],(k*Mirror*([0.00015;0.21838;0.03321])    -CoM_Thigh);...
    ['GluteusMaximusSuperior1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0117;0.28838;0.04548])    -CoM_Thigh);...
    ['GluteusMaximusSuperior2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.0117;0.28838;0.04548])    -CoM_Thigh);...
    ['GluteusMaximusSuperior3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01046;0.28094;0.04338])   -CoM_Thigh);...
    ['GluteusMaximusSuperior4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01046;0.28094;0.04338])   -CoM_Thigh);...
    ['GluteusMaximusSuperior5Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00953;0.27348;0.04108])   -CoM_Thigh);...
    ['GluteusMaximusSuperior6Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00953;0.27348;0.04108])   -CoM_Thigh);...
    ['GluteusMediusAnterior1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00379;0.34932;0.06574])    -CoM_Thigh);...
    ['GluteusMediusAnterior2Insertion1' Signe 'Thigh'],(k*Mirror*([0.00213;0.34856;0.06489])     -CoM_Thigh);...
    ['GluteusMediusAnterior3Insertion1' Signe 'Thigh'],(k*Mirror*([0.00048;0.3539;0.06414])      -CoM_Thigh);...
    ['GluteusMediusAnterior4Insertion1' Signe 'Thigh'],(k*Mirror*([0.00879;0.35158;0.06124])     -CoM_Thigh);...
    ['GluteusMediusAnterior5Insertion1' Signe 'Thigh'],(k*Mirror*([0.00838;0.35579;0.05972])     -CoM_Thigh);...
    ['GluteusMediusAnterior6Insertion1' Signe 'Thigh'],(k*Mirror*([0.01537;0.35358;0.05599])     -CoM_Thigh);...
    ['GluteusMediusPosterior1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01014;0.34942;0.06367])   -CoM_Thigh);...
    ['GluteusMediusPosterior2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00718;0.35174;0.06344])   -CoM_Thigh);...
    ['GluteusMediusPosterior3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01579;0.35539;0.05894])   -CoM_Thigh);...
    ['GluteusMediusPosterior4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01142;0.35907;0.05855])   -CoM_Thigh);...
    ['GluteusMediusPosterior5Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01977;0.35915;0.05206])   -CoM_Thigh);...
    ['GluteusMediusPosterior6Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01664;0.36185;0.05178])   -CoM_Thigh);...
    ['GluteusMinimusAnterior1Insertion1' Signe 'Thigh'],(k*Mirror*([0.01716;0.32615;0.0516])     -CoM_Thigh);...
    ['GluteusMinimusAnterior2Insertion1' Signe 'Thigh'],(k*Mirror*([0.01716;0.32615;0.0516])     -CoM_Thigh);...
    ['GluteusMinimusMid1Insertion1' Signe 'Thigh'],(k*Mirror*([0.01735;0.33517;0.05215])         -CoM_Thigh);...
    ['GluteusMinimusMid2Insertion1' Signe 'Thigh'],(k*Mirror*([0.01735;0.33517;0.05215])         -CoM_Thigh);...
    ['GluteusMinimusPosterior1Insertion1' Signe 'Thigh'],(k*Mirror*([0.01593;0.34569;0.0523])    -CoM_Thigh);...
    ['GluteusMinimusPosterior2Insertion1' Signe 'Thigh'],(k*Mirror*([0.01593;0.34569;0.0523])    -CoM_Thigh);...
    ['IliacusLateralis1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01139;0.30134;0.0169])          -CoM_Thigh);...
    ['IliacusLateralis2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00963;0.29515;0.0222])          -CoM_Thigh);...
    ['IliacusMedialis1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01139;0.30134;0.0169])           -CoM_Thigh);...
    ['IliacusMedialis2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00963;0.29515;0.0222])           -CoM_Thigh);...
    ['IliacusMid1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01139;0.30134;0.0169])                -CoM_Thigh);...
    ['IliacusMid2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00963;0.29515;0.0222])                -CoM_Thigh);...
    ['ObturatorExternusInferior1Via1' Signe 'Thigh'],(k*Mirror*([-0.015;0.338;0.01])             -CoM_Thigh);...
    ['ObturatorExternusInferior1Insertion2' Signe 'Thigh'],(k*Mirror*([-0.01228;0.34359;0.03067])-CoM_Thigh);...
    ['ObturatorExternusInferior2Via1' Signe 'Thigh'],(k*Mirror*([-0.015;0.338;0.01])             -CoM_Thigh);...
    ['ObturatorExternusInferior2Insertion2' Signe 'Thigh'],(k*Mirror*([-0.01228;0.34359;0.03067])-CoM_Thigh);...
    ['ObturatorExternusSuperior1Via1' Signe 'Thigh'],(k*Mirror*([-0.015;0.338;0.01])             -CoM_Thigh);...
    ['ObturatorExternusSuperior1Insertion2' Signe 'Thigh'],(k*Mirror*([-0.01228;0.34359;0.03067])-CoM_Thigh);...
    ['ObturatorExternusSuperior2Via1' Signe 'Thigh'],(k*Mirror*([-0.015;0.338;0.01])             -CoM_Thigh);...
    ['ObturatorExternusSuperior2Insertion2' Signe 'Thigh'],(k*Mirror*([-0.01228;0.34359;0.03067])-CoM_Thigh);...
    ['ObturatorExternusSuperior3Via1' Signe 'Thigh'],(k*Mirror*([-0.015;0.338;0.01])             -CoM_Thigh);...
    ['ObturatorExternusSuperior3Insertion2' Signe 'Thigh'],(k*Mirror*([-0.01228;0.34359;0.03067])-CoM_Thigh);...
    ['ObturatorInternus1Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['ObturatorInternus2Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['ObturatorInternus3Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['ObturatorInternus4Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['ObturatorInternus5Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['ObturatorInternus6Insertion1' Signe 'Thigh'],(k*Mirror*([-1e-05;0.35651;0.04529])          -CoM_Thigh);...
    ['Pectineus1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01239;0.28657;0.03165])                -CoM_Thigh);...
    ['Pectineus2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01002;0.27797;0.03517])                -CoM_Thigh);...
    ['Pectineus3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00821;0.26952;0.03433])                -CoM_Thigh);...
    ['Pectineus4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.00708;0.26132;0.0334])                 -CoM_Thigh);...
    ['Piriformis1Insertion1' Signe 'Thigh'],(k*Mirror*([0.00153;0.36326;0.05249])                -CoM_Thigh);...
    ['Plantaris1Origin1' Signe 'Thigh'],(k*Mirror*([-0.00776;0.0122;0.03011])                    -CoM_Thigh);...
    ['Popliteus1Origin1' Signe 'Thigh'],(k*Mirror*([-0.01623;-0.02194;0.02249])                  -CoM_Thigh);...
    ['Popliteus2Origin1' Signe 'Thigh'],(k*Mirror*([-0.01477;-0.02348;0.02828])                  -CoM_Thigh);...
    ['Popliteus3Origin1' Signe 'Thigh'],(k*Mirror*([-0.01219;-0.02455;0.03346])                  -CoM_Thigh);...
    ['PsoasMajor1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01551;0.30733;0.01332])               -CoM_Thigh);...
    ['PsoasMajor2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01551;0.30733;0.01332])               -CoM_Thigh);...
    ['PsoasMajor3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01551;0.30733;0.01332])               -CoM_Thigh);...
    ['PsoasMajor4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01551;0.30733;0.01332])               -CoM_Thigh);...
    ['PsoasMajor5Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01551;0.30733;0.01332])               -CoM_Thigh);...
    ['QuadratusFemoris1Insertion1' Signe 'Thigh'],(k*Mirror*([-0.02018;0.34341;0.04217])         -CoM_Thigh);...
    ['QuadratusFemoris2Insertion1' Signe 'Thigh'],(k*Mirror*([-0.02468;0.33712;0.04391])         -CoM_Thigh);...
    ['QuadratusFemoris3Insertion1' Signe 'Thigh'],(k*Mirror*([-0.02434;0.32528;0.0464])          -CoM_Thigh);...
    ['QuadratusFemoris4Insertion1' Signe 'Thigh'],(k*Mirror*([-0.01767;0.3109;0.0468])           -CoM_Thigh);...
    ['Sartorius1Via1' Signe 'Thigh'],(k*Mirror*([0.042187;0.34;0.0017475])                       -CoM_Thigh);...
    ['Sartorius1Via2' Signe 'Thigh'],(k*Mirror*([0.034481;0.2375;-0.017538])                     -CoM_Thigh);...
    ['Sartorius1Via3' Signe 'Thigh'],(k*Mirror*([0.0085826;0.14503;-0.025708])                   -CoM_Thigh);...
    ['Sartorius1Via4' Signe 'Thigh'],(k*Mirror*([-0.005957;0.078864;-0.032495])                  -CoM_Thigh);...
    ['Sartorius1Via5' Signe 'Thigh'],(k*Mirror*([-0.025196;0.010221;-0.040041])                  -CoM_Thigh);...
    ['VastusIntermedius1Origin1' Signe 'Thigh'],(k*Mirror*([0.01612;0.2768;0.03078])             -CoM_Thigh);...
    ['VastusIntermedius2Origin1' Signe 'Thigh'],(k*Mirror*([0.00307;0.27226;0.04922])            -CoM_Thigh);...
    ['VastusIntermedius3Origin1' Signe 'Thigh'],(k*Mirror*([0.01259;0.20295;0.01122])            -CoM_Thigh);...
    ['VastusIntermedius4Origin1' Signe 'Thigh'],(k*Mirror*([0.00202;0.19948;0.02964])            -CoM_Thigh);...
    ['VastusIntermedius5Origin1' Signe 'Thigh'],(k*Mirror*([0.029;0.1196;0.01242])               -CoM_Thigh);...
    ['VastusIntermedius6Origin1' Signe 'Thigh'],(k*Mirror*([0.02021;0.11731;0.02719])            -CoM_Thigh);...
    ['VastusLateralisInferior1Origin1' Signe 'Thigh'],(k*Mirror*([-0.00799;0.28089;0.04663])     -CoM_Thigh);...
    ['VastusLateralisInferior2Origin1' Signe 'Thigh'],(k*Mirror*([-0.00211;0.23091;0.0352])      -CoM_Thigh);...
    ['VastusLateralisInferior3Origin1' Signe 'Thigh'],(k*Mirror*([0.00249;0.18389;0.02637])      -CoM_Thigh);...
    ['VastusLateralisInferior4Origin1' Signe 'Thigh'],(k*Mirror*([0.0043;0.13948;0.02228])       -CoM_Thigh);...
    ['VastusLateralisInferior5Origin1' Signe 'Thigh'],(k*Mirror*([0.00403;0.09823;0.02102])      -CoM_Thigh);...
    ['VastusLateralisInferior6Origin1' Signe 'Thigh'],(k*Mirror*([0.00391;0.06017;0.02207])      -CoM_Thigh);...
    ['VastusLateralisSuperior1Origin1' Signe 'Thigh'],(k*Mirror*([0.01584;0.33503;0.04286])      -CoM_Thigh);...
    ['VastusLateralisSuperior2Origin1' Signe 'Thigh'],(k*Mirror*([-0.00461;0.3114;0.05643])      -CoM_Thigh);...
    ['VastusMedialisInferior1Origin1' Signe 'Thigh'],(k*Mirror*([0.00254;0.13959;0.01141])       -CoM_Thigh);...
    ['VastusMedialisInferior2Origin1' Signe 'Thigh'],(k*Mirror*([0.00133;0.10576;0.0115])        -CoM_Thigh);...
    ['VastusMedialisMid1Origin1' Signe 'Thigh'],(k*Mirror*([0.00086;0.20011;0.02082])            -CoM_Thigh);...
    ['VastusMedialisMid2Origin1' Signe 'Thigh'],(k*Mirror*([0.00195;0.17032;0.0145])             -CoM_Thigh);...
    ['VastusMedialisSuperior1Origin1' Signe 'Thigh'],(k*Mirror*([0.00951;0.31153;0.02639])       -CoM_Thigh);...
    ['VastusMedialisSuperior2Origin1' Signe 'Thigh'],(k*Mirror*([-0.00162;0.30299;0.02059])      -CoM_Thigh);...
    ['VastusMedialisSuperior3Origin1' Signe 'Thigh'],(k*Mirror*([-0.00459;0.28775;0.02312])      -CoM_Thigh);...
    ['VastusMedialisSuperior4Origin1' Signe 'Thigh'],(k*Mirror*([-0.00349;0.26498;0.02467])      -CoM_Thigh);...
    ['Wrap' Signe 'Thigh' 'Illiopsoas']             ,k*Mirror*([-0.0149;	0.3890;-0.0350]) -   CoM_Thigh;...
    ['Wrap' Signe 'Thigh' 'QuadricepsFemoris']      ,k*Mirror*([0.0022;	-0.0067;	-0.0589]) -   CoM_Thigh;...
    ['Wrap' Signe 'Thigh' 'Gastrocnemius']          ,k*Mirror*([-0.0030;	-0.0068;	0.0586]) -   CoM_Thigh;...
    };


%%                     Mise à l'échelle des inerties
    %% ["Adjustments to McConville et al. and Young et al. body segment inertial parameters"] R. Dumas
    % ---------------------------- Thigh --------------------------------------
    Length_Thigh=norm(Thigh_KneeJointNode-Thigh_HipJointNode);
    [I_Thigh]=rgyration2inertia([29 15 30 7 2*1i 7*1i], Mass.Thigh_Mass, [0 0 0], Length_Thigh, Signe);


%% Création de la structure "Human_model"

num_solid=0;
%% Thigh
% Hip_J1
num_solid=num_solid+1;        % solide numéro ...
name=list_solid{num_solid}; % nom du solide
eval(['incr_solid=s_' name ';'])  % numéro du solide dans le modèle
Human_model(incr_solid).name=[Signe name];   % nom du solide ('R' ou 'L' en suffixe)
Human_model(incr_solid).sister=0;                 % sister : définit en entrée de la fonction
Human_model(incr_solid).child=s_Hip_J2;                % child : Shank
Human_model(incr_solid).mother=s_mother;                 % mother : définit en fonction du pt d'attache
Human_model(incr_solid).a=[0 0 1]';                    % rotation /z
Human_model(incr_solid).joint=1;                        % liaison pivot
Human_model(incr_solid).limit_inf=-pi/4;               % butée articulaire inférieure
Human_model(incr_solid).limit_sup=2*pi/3;                % butée articulaire supérieure
Human_model(incr_solid).ActiveJoint=1;
Human_model(incr_solid).Visual=0;
Human_model(incr_solid).m=0;                           % masse de référence
Human_model(incr_solid).b=pos_attachment_pt;              % position du point d'attache par rapport au repère parent                     A MODIFIER
Human_model(incr_solid).I=zeros(3,3);                  % matrice d'inertie de référence
Human_model(incr_solid).c=[0 0 0]';                    % position du centre de masse dans le repère local
Human_model(incr_solid).calib_k_constraint=[];
Human_model(incr_solid).u=[];                          % rotation fixe selon l'axe u d'un angle theta (après la rotation q)
Human_model(incr_solid).theta=[];
Human_model(incr_solid).KinematicsCut=[];              % coupure cinématique
Human_model(incr_solid).ClosedLoop=[];                 % si solide de fermeture de boucle : {numéro du solide i sur lequel est attaché ce solide ; point d'attache (repère du solide i)}
Human_model(incr_solid).linear_constraint=[];
OsteoArticularModel(incr_solid).comment='Hip Flexion(+)/Extension(-) - Z-Rotation';

% Hip_J2
num_solid=num_solid+1;        % solide numéro ...
name=list_solid{num_solid}; % nom du solide
eval(['incr_solid=s_' name ';'])  % numéro du solide dans le modèle
Human_model(incr_solid).name=[Signe name];
Human_model(incr_solid).sister=0;
Human_model(incr_solid).child=s_Thigh;
Human_model(incr_solid).mother=s_Hip_J1;
Human_model(incr_solid).a=[1 0 0]';
Human_model(incr_solid).joint=1;
Human_model(incr_solid).limit_inf=-pi/4;
Human_model(incr_solid).limit_sup=pi/4;
Human_model(incr_solid).ActiveJoint=1;
Human_model(incr_solid).Visual=0;
Human_model(incr_solid).m=0;
Human_model(incr_solid).b=[0 0 0]';
Human_model(incr_solid).I=zeros(3,3);
Human_model(incr_solid).c=[0 0 0]';
if Signe=='R'
    Human_model(incr_solid).comment='Hip Abduction(-)/Adduction(+) - X-Rotation';
else
    Human_model(incr_solid).comment='Hip Abduction(+)/Adduction(-) - X-Rotation';
end

% Thigh
num_solid=num_solid+1;        % solide numéro ...
name=list_solid{num_solid}; % nom du solide
eval(['incr_solid=s_' name ';'])  % numéro du solide dans le modèle
Human_model(incr_solid).name=[Signe name];
Human_model(incr_solid).sister=0;
Human_model(incr_solid).child=0;
Human_model(incr_solid).mother=s_Hip_J2;
Human_model(incr_solid).a=[0 1 0]';
Human_model(incr_solid).joint=1;
Human_model(incr_solid).limit_inf=-pi/2;
Human_model(incr_solid).limit_sup=pi/2;
Human_model(incr_solid).ActiveJoint=1;
Human_model(incr_solid).Visual=1;
Human_model(incr_solid).m=Mass.Thigh_Mass;
Human_model(incr_solid).b=[0 0 0]';
Human_model(incr_solid).I=[I_Thigh(1) I_Thigh(4) I_Thigh(5); I_Thigh(4) I_Thigh(2) I_Thigh(6); I_Thigh(5) I_Thigh(6) I_Thigh(3)];
Human_model(incr_solid).c=-Thigh_HipJointNode;
Human_model(incr_solid).anat_position=Thigh_position_set;
Human_model(incr_solid).L={[Signe 'Thigh_HipJointNode'];[Signe 'Thigh_KneeJointNode'];[Signe 'Thigh_PatellaFemurJointNode']};
Human_model(incr_solid).visual_file = ['TLEM/' Signe 'Thigh.mat'];
if Signe=='R'
    Human_model(incr_solid).comment='Hip Internal(+)/External(-) Rotation';
else
    Human_model(incr_solid).comment='Hip Internal(-)/External(+) Rotation';
end


% Wrapping 1
Human_model(incr_solid).wrap(1).name=['Wrap' Signe 'Thigh' 'Illiopsoas'];
Human_model(incr_solid).wrap(1).anat_position=['Wrap' Signe 'Thigh' 'Illiopsoas'];
Human_model(incr_solid).wrap(1).type='C'; % C: Cylinder or S: Sphere
Human_model(incr_solid).wrap(1).R=0.0275;
Human_model(incr_solid).wrap(1).orientation=[   -0.928070502539686  ,Mirror(end)*0.284251353681878,     Mirror(end)*0.2406;...
                                                        -0.372404541212556  ,Mirror(end)*-0.708383672766642,    -0.5996           ;...
                                                        0                   ,-0.646060167544528,                Mirror(end)*0.7633];
Human_model(incr_solid).wrap(1).location=k*[-0.0149;	0.3890;	Mirror(end)*-0.0350] -   CoM_Thigh;
Human_model(incr_solid).wrap(1).h=0.35;
Human_model(incr_solid).wrap(1).num_solid=incr_solid;

% Wrapping 2
Human_model(incr_solid).wrap(2).name=['Wrap' Signe 'Thigh' 'QuadricepsFemoris'];
Human_model(incr_solid).wrap(2).anat_position=['Wrap' Signe 'Thigh' 'QuadricepsFemoris'];
Human_model(incr_solid).wrap(2).type='C'; % C: Cylinder or S: Sphere
Human_model(incr_solid).wrap(2).R=0.0250;
Human_model(incr_solid).wrap(2).orientation=[0.404154809628085, Mirror(end)*0.893248353115711,  Mirror(end)*0.1969;...
                                                    -0.914690597882413, Mirror(end)*0.394680582636195,  0.087;...
                                                     0              ,   -0.215254773108573,             Mirror(end)*0.9766];
Human_model(incr_solid).wrap(2).location=k*[0.0022;	-0.0067;	Mirror(end)*-0.0589] -   CoM_Thigh;
Human_model(incr_solid).wrap(2).h=0.35;
Human_model(incr_solid).wrap(2).num_solid=incr_solid;

% Wrapping 3
Human_model(incr_solid).wrap(3).name=['Wrap' Signe 'Thigh' 'Gastrocnemius'];
Human_model(incr_solid).wrap(3).anat_position=['Wrap' Signe 'Thigh' 'Gastrocnemius'];
Human_model(incr_solid).wrap(3).type='C'; % C: Cylinder or S: Sphere
Human_model(incr_solid).wrap(3).R=0.0175;
Human_model(incr_solid).wrap(3).orientation=[-0.0648854012091891,   Mirror(end)*0.988882451668858,  Mirror(end)*-0.1338;...
                                                        0.997892722044771,  Mirror(end)*0.0642995316107553, -0.0087;...
                                                        0,                  -0.134078585225335, Mirror(end)*-0.991];
Human_model(incr_solid).wrap(3).location=k*[-0.0030;	-0.0068;	Mirror(end)*0.0586]	-   CoM_Thigh;
Human_model(incr_solid).wrap(3).h=0.35;
Human_model(incr_solid).wrap(3).num_solid=incr_solid;


end
